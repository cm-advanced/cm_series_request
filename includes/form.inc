<?
/*
 * Created on May 16, 2017
 * Created by Charlotta Beavers
 * lottie@openflows.com
 * www.openflows.com
 * Created for Open Signal PDX (PCM)
 * 
 * form API
 */

/**
  * Admin form for setting email text for scheduled series requests
**/
function cm_series_request_submitted_confirmation_email_admin_form($form, &$form_state) {
  
  $form = array();
  
  $form['intro-text'] = array(
    '#markup' => '<p><b>Introduction</b></p><p><b><em>The intro states the folowing:</em></b><br> Your project submission has been received for <em>Project Title</em> and is pending review by a Open Signal staff. The review process and scheduling can take up to three weeks.</p>'
  );
  $form['custom-intro'] = array(
    '#title' => t('Custom Introduction'),
    '#type' => 'textarea',
    '#description' => t
    ('Enter any further text that should appear after the initial introduction.'),
    '#default_value' => variable_get('series_request_submitted_confirmation_email_custom_intro', NULL),
    '#rows' => 8,
    '#cols' => 60,    
    '#resizable' => TRUE,
  );
  
  $form['body-text'] = array(
    '#markup' => '<p><b>Body</b></p><p>The body of the email lists the submitted content for each field submitted on the request.</p>'
  );

  $form['closing'] = array(
    '#title' => t('Closing'),
    '#type' => 'textarea',
    '#description' => t
    ('Email closing for series request scheduling email notification.'),
    '#default_value' => variable_get('series_request_submitted_confirmation_email_closing', NULL),
    '#required' => TRUE,    
    '#rows' => 25,
    '#cols' => 60,    
    '#resizable' => TRUE,
  );
  
  $form['submit_button'] = array(
    '#type' => 'submit',
    '#value' => t('Save'),   
  );
  
  return $form;
}

function cm_series_request_submitted_confirmation_email_admin_form_submit($form, &$form_state) {
  variable_set('series_request_submitted_confirmation_email_custom_intro', $form_state['values']['custom-intro']);
  variable_set('series_request_submitted_confirmation_email_closing', $form_state['values']['closing']);
  
  drupal_set_message(t('Your configuration has been saved.'));  
} 
 
/**
  * Admin form for setting email text for scheduled series requests
**/
function cm_series_request_schedule_confirmation_email_admin_form($form, &$form_state) {
  
  $form = array();
  $form['intro'] = array(
    '#title' => t('Introduction'),
    '#type' => 'textarea',
    '#description' => t
    ('Email introduction for series request scheduling email notification.'),
    '#default_value' => variable_get('series_request_schedule_confirmation_email_intro', NULL),
    '#required' => TRUE,
    '#rows' => 8,
    '#cols' => 60,    
    '#resizable' => TRUE,
  );
  
  $form['some_text'] = array(
    '#markup' => '<p><b>Body</b></p><p>The body of the email appears after the introduction and is generated by the system. This includes the season and season dates, followed by the schedule.</p><p>Sample:</p>
    <pre>
     The Summer 2017 Season is Saturday, July 1, 2017 to Saturday, September 30, 2017.

     Channel      Date         Time       Show
     -------------------------------------------------------------
     Channel 11   07-01-2017   09:00 am   test project title: TBD
    </pre>'
  );

  $form['closing'] = array(
    '#title' => t('Closing'),
    '#type' => 'textarea',
    '#description' => t
    ('Email closing for series request scheduling email notification.'),
    '#default_value' => variable_get('series_request_schedule_confirmation_email_closing', NULL),
    '#required' => TRUE,    
    '#rows' => 25,
    '#cols' => 60,    
    '#resizable' => TRUE,
  );
  
  $form['submit_button'] = array(
    '#type' => 'submit',
    '#value' => t('Save'),   
  );
  
  return $form;
}

function cm_series_request_schedule_confirmation_email_admin_form_submit($form, &$form_state) {
  variable_set('series_request_schedule_confirmation_email_intro', $form_state['values']['intro']);
  variable_set('series_request_schedule_confirmation_email_closing', $form_state['values']['closing']);
  
  drupal_set_message(t('Your configuration has been saved.'));  
}

/**
  * Allow user to enter a preview address instead of using the producers & staff
  * email addresses
**/
function cm_series_request_schedule_confirmation_email_form($settings, 
							    &$form_state) {
  $form = array();
  $form['pcm_preview_email'] = 
    array(
	   '#type' => 'textfield',
	   '#size' => 60,
	   '#maxlength' => 100,
	   '#required' => FALSE,	   
	   '#title' => t('Preview Email Address'),
	   '#description' => t("If you enter a value here the email will be sent to that email address, otherwise this will be sent to the Producer of the Project for the Series Request and staff."),
	   '#default_value' => !empty($settings['pcm_preview_email']) ? 
        $settings['pcm_preview_email'] : '',
	  );
  
  return $form;
}

function cm_series_request_schedule_confirmation_email_submit($form, 
							      &$form_state) {
  //SETTING AS SESSION VAR AS BELOW DOESNT WORK THOUGH IT SHOULD
  
  $_SESSION['pcm_preview_email'] = $form_state['values']['pcm_preview_email'];

  $return = array();
  $return['pcm_preview_email'] = $form_state['values']['pcm_preview_email'];
  return $return;
}